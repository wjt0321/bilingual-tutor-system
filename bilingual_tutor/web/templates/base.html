<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>{% block title %}åŒè¯­å¯¼å¸ˆç³»ç»Ÿ{% endblock %}</title>
    <meta name="description" content="ä¸ªæ€§åŒ–åŒè¯­å­¦ä¹ åŠ©æ‰‹ - è‹±è¯­å’Œæ—¥è¯­æ™ºèƒ½å­¦ä¹ ç³»ç»Ÿ">
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="åŒè¯­å¯¼å¸ˆ">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-TileColor" content="#3b82f6">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% block head %}{% endblock %}
</head>
<body class="{% block body_class %}{% endblock %}">
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">è·³è½¬åˆ°ä¸»è¦å†…å®¹</a>
    
    <!-- Navigation -->
    {% if is_authenticated %}
    <nav class="navbar" role="navigation" aria-label="ä¸»å¯¼èˆª">
        <div class="nav-brand">
            <span class="logo" role="img" aria-label="ä¹¦æœ¬å›¾æ ‡">ğŸ“š</span>
            <span class="brand-text">åŒè¯­å¯¼å¸ˆ</span>
        </div>
        <div class="nav-links">
            <a href="{{ url_for('main.index') }}" 
               class="nav-link {% if request.endpoint == 'main.index' %}active{% endif %}"
               aria-current="{% if request.endpoint == 'main.index' %}page{% endif %}">
                <span class="nav-icon" role="img" aria-label="é¦–é¡µå›¾æ ‡">ğŸ </span>
                <span>é¦–é¡µ</span>
            </a>
            <a href="{{ url_for('main.learn_page') }}" 
               class="nav-link {% if request.endpoint == 'main.learn_page' %}active{% endif %}"
               aria-current="{% if request.endpoint == 'main.learn_page' %}page{% endif %}">
                <span class="nav-icon" role="img" aria-label="å­¦ä¹ å›¾æ ‡">ğŸ“–</span>
                <span>å­¦ä¹ </span>
            </a>
            <a href="{{ url_for('main.progress_page') }}" 
               class="nav-link {% if request.endpoint == 'main.progress_page' %}active{% endif %}"
               aria-current="{% if request.endpoint == 'main.progress_page' %}page{% endif %}">
                <span class="nav-icon" role="img" aria-label="è¿›åº¦å›¾æ ‡">ğŸ“Š</span>
                <span>è¿›åº¦</span>
            </a>
            <a href="{{ url_for('main.settings_page') }}" 
               class="nav-link {% if request.endpoint == 'main.settings_page' %}active{% endif %}"
               aria-current="{% if request.endpoint == 'main.settings_page' %}page{% endif %}">
                <span class="nav-icon" role="img" aria-label="è®¾ç½®å›¾æ ‡">âš™ï¸</span>
                <span>è®¾ç½®</span>
            </a>
        </div>
        <div class="nav-user">
            <span class="user-name">
                <span role="img" aria-label="ç”¨æˆ·å›¾æ ‡">ğŸ‘¤</span> 
                {{ user_id }}
            </span>
            <button class="btn-logout" onclick="BilingualTutor.logout()" aria-label="é€€å‡ºç™»å½•">
                é€€å‡º
            </button>
        </div>
    </nav>
    {% endif %}

    <!-- Main Content -->
    <main class="main-content" id="main-content" role="main">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <p>Â© {{ current_year }} åŒè¯­å¯¼å¸ˆç³»ç»Ÿ v{{ app_version }} | ä¸ªäººå­¦ä¹ ä¸“ç”¨</p>
    </footer>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/mobile.js') }}"></script>
    {% block scripts %}{% endblock %}
    
    <!-- Service Worker Registration for PWA capabilities -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/js/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                        registration.onupdatefound = function() {
                            const installingWorker = registration.installing;
                            installingWorker.onstatechange = function() {
                                if (installingWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('New content is available; please refresh.');
                                    if (window.confirm('æœ‰æ–°ç‰ˆæœ¬å¯ç”¨,æ˜¯å¦åˆ·æ–°é¡µé¢?')) {
                                        window.location.reload();
                                    }
                                }
                            };
                        };
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
            
            navigator.serviceWorker.addEventListener('controllerchange', function() {
                window.location.reload();
            });
        }
    </script>
</body>
</html>
